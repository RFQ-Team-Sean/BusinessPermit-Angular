<div class="container mx-auto px-4 py-8">
  <!-- Header Section with Search and Add User Button -->
  <div class="flex flex-col md:flex-row gap-5 mb-8">
    <form class="flex-grow md:w-[55%] flex items-center py-2 px-4 bg-white rounded-full border border-gray-300 shadow-sm">
      <img
        loading="lazy"
        src="https://cdn.builder.io/api/v1/image/assets/TEMP/cac385ff8a5ba60507c16d53f9929f7946c495ef16d0c7ebd68607c53926f609?placeholderIfAbsent=true&apiKey=f814d152556d45aeb58d44f206a3cbd4"
        alt="Search Icon"
        class="w-5 h-5 mr-3"
      />
      <label for="searchInput" class="sr-only">Search</label>
      <input
        type="search"
        id="searchInput"
        [(ngModel)]="searchTerm"
        name="searchTerm"
        placeholder="Search users..."
        class="w-full bg-transparent border-none outline-none text-sm"
      />
    </form>
    <div class="flex items-center justify-between md:justify-end gap-4">
      <button
        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-300 ease-in-out flex items-center"
        (click)="openAddUserModal()"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
        Add User
      </button>
      <div class="flex items-center gap-4 text-sm font-semibold text-gray-700">
        <div class="relative">
          <button (click)="toggleSortDropdown()" class="flex items-center gap-2 hover:text-blue-500 transition duration-300 ease-in-out">
            <span>Sort by: {{ currentSort }}</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h7a1 1 0 100-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z" />
            </svg>
          </button>
          <div *ngIf="showSortDropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10">
            <div class="py-1">
              <a *ngFor="let option of sortOptions" (click)="sortUsers(option)" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer">
                {{ option }}
              </a>
            </div>
          </div>
        </div>
        <div class="relative">
          <button (click)="toggleSavedSearchDropdown()" class="flex items-center gap-2 hover:text-blue-500 transition duration-300 ease-in-out">
            <span>Saved search</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd" />
            </svg>
          </button>
          <div *ngIf="showSavedSearchDropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10">
            <div class="py-1">
              <a *ngFor="let search of savedSearches" (click)="applySavedSearch(search)" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer">
                {{ search.name }}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- User Table Section -->
  <div class="bg-white rounded-lg shadow-md overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
            <th class="px-6 py-3 cursor-pointer" (click)="sortUsers('Name (A-Z)')">Name</th>
            <th class="px-6 py-3 cursor-pointer" (click)="sortUsers('Email (A-Z)')">Email</th>
            <th class="px-6 py-3">Phone</th>
            <th class="px-6 py-3 cursor-pointer" (click)="sortUsers('Join Date (Newest)')">Registration Date</th>
            <th class="px-6 py-3">Role</th>
            <th class="px-6 py-3 text-center">Action</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <tr *ngFor="let user of paginatedUsers" class="hover:bg-gray-50 transition duration-300 ease-in-out">
            <td class="px-6 py-4 whitespace-nowrap">{{ user.name }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ user.email }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ user.phone }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ user.joinDate }}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span [ngClass]="{
                'bg-green-100 text-green-800': user.role === 'Admin',
                'bg-blue-100 text-blue-800': user.role === 'User'
              }" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                {{ user.role }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-center">
              <button
                (click)="openEditUserModal(user)"
                class="text-indigo-600 hover:text-indigo-900 mr-4 focus:outline-none focus:underline"
              >
                Edit
              </button>
              <button
                (click)="deleteUser(user)"
                class="text-red-600 hover:text-red-900 focus:outline-none focus:underline"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- Handle case when no users are found -->
    <div *ngIf="filteredUsers.length === 0" class="text-center p-8 text-gray-500">
      No users found.
    </div>
  </div>

  <!-- Pagination Section -->
  <div class="mt-6 flex flex-col sm:flex-row items-center justify-between">
    <div class="flex items-center mb-4 sm:mb-0">
      <span class="mr-2 text-sm text-gray-700">Items per page:</span>
      <select
        [(ngModel)]="itemsPerPage"
        (ngModelChange)="onItemsPerPageChange()"
        name="itemsPerPage"
        class="border rounded-md text-sm px-2 py-1"
        aria-label="Select items per page"
      >
        <option *ngFor="let num of itemsPerPageOptions" [value]="num">{{ num }}</option>
      </select>
    </div>
    <div class="flex items-center">
      <button
        *ngFor="let page of [].constructor(totalPages); let i = index"
        (click)="onPageChange(i + 1)"
        [class.bg-blue-500]="currentPage === i + 1"
        [class.text-white]="currentPage === i + 1"
        class="px-3 py-1 rounded-md text-sm font-medium mx-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        {{ i + 1 }}
      </button>
    </div>
    <div class="text-sm text-gray-700 mt-4 sm:mt-0">
      Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredUsers.length) }} of {{ filteredUsers.length }} results
    </div>
  </div>
</div>

<!-- Add/Edit User Modal -->
<app-add-user-modal
  *ngIf="showModal"
  [user]="selectedUser"
  (userAdded)="handleUserAdded($event)"
  (userUpdated)="handleUserUpdated($event)"
  (modalClosed)="closeModal()"
></app-add-user-modal>
