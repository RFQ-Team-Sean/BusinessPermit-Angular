<div class="container mx-auto px-4 py-8">
  <!-- Header Section -->
  <div class="flex flex-col md:flex-row gap-5 mb-8">
    <!-- Search Bar -->
    <form class="flex-grow md:w-[55%] flex items-center py-2 px-4 bg-white rounded-full border border-gray-300 shadow-sm">
      <img
        loading="lazy"
        src="https://cdn.builder.io/api/v1/image/assets/TEMP/cac385ff8a5ba60507c16d53f9929f7946c495ef16d0c7ebd68607c53926f609?placeholderIfAbsent=true&apiKey=f814d152556d45aeb58d44f206a3cbd4"
        alt="Search Icon"
        class="w-5 h-5 mr-3"
      />
      <label for="searchInput" class="sr-only">Search</label>
      <input
        type="search"
        id="searchInput"
        [(ngModel)]="searchQuery"
        (input)="onSearch($event)"
        name="search"
        placeholder="Search by name, address, or phone"
        class="w-full bg-transparent border-none outline-none text-sm"
      />
    </form>

    <!-- Action Buttons and Dropdowns -->
    <div class="flex items-center justify-between md:justify-end gap-4">
      <!-- Add Business Button -->
      <button
        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-300 ease-in-out flex items-center"
        (click)="openModal()"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
        Add Business
      </button>

      <!-- Sort and Saved Search Dropdowns -->
      <div class="flex items-center gap-4 text-sm font-semibold text-gray-700">
        <!-- Sort Dropdown -->
        <div class="relative">
          <button (click)="sortMenuOpen = !sortMenuOpen" class="flex items-center gap-2 hover:text-blue-500 transition duration-300 ease-in-out">
            <span>Sort by: {{ getSortLabel() }}</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h7a1 1 0 100-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z" />
            </svg>
          </button>
          <div *ngIf="sortMenuOpen" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10">
            <div class="py-1">
              <a *ngFor="let option of sortOptions" 
                 (click)="sortUsers(option.key); sortMenuOpen = false" 
                 class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer">
                {{ option.label }}
              </a>
            </div>
          </div>
        </div>

        <!-- Saved Search Dropdown -->
        <div class="relative">
          <button (click)="savedSearchMenuOpen = !savedSearchMenuOpen" class="flex items-center gap-2 hover:text-blue-500 transition duration-300 ease-in-out">
            <span>Saved search</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd" />
            </svg>
          </button>
          <div *ngIf="savedSearchMenuOpen" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10">
            <div class="py-1">
              <a *ngFor="let search of savedSearches" 
                 (click)="applySavedSearch(search); savedSearchMenuOpen = false" 
                 class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer">
                {{ search }}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Business Table Section -->
<div class="bg-white rounded-lg shadow-md overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead>
        <tr class="bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
          <th class="px-6 py-3 cursor-pointer" (click)="sortUsers('name')">Business Name</th>
          <th class="px-6 py-3 cursor-pointer" (click)="sortUsers('address')">Address</th>
          <th class="px-6 py-3 cursor-pointer" (click)="sortUsers('phone')">Phone</th>
          <th class="px-6 py-3 cursor-pointer" (click)="sortUsers('joinDate')">Registration Date</th>
          <th class="px-6 py-3 cursor-pointer" (click)="sortUsers('status')">Status</th>
          <th class="px-6 py-3 text-center">Action</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <tr *ngFor="let user of users" class="hover:bg-gray-50 transition duration-300 ease-in-out">
          <td class="px-6 py-4 whitespace-nowrap">{{ user.name }}</td>
          <td class="px-6 py-4 whitespace-nowrap">{{ user.address }}</td>
          <td class="px-6 py-4 whitespace-nowrap">{{ user.phone }}</td>
          <td class="px-6 py-4 whitespace-nowrap">{{ user.joinDate }}</td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span [ngClass]="getStatusClass(user.status)" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
              {{ user.status }}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-center">
            <ng-container *ngIf="user.status === 'pending'; else otherAction">
              <button
                (click)="handleAction(user, 'approve')"
                class="text-green-600 hover:text-green-900 focus:outline-none focus:underline mr-2"
              >
                Approve
              </button>
              <button
                (click)="handleAction(user, 'reject')"
                class="text-red-600 hover:text-red-900 focus:outline-none focus:underline"
              >
                Reject
              </button>
            </ng-container>
            <ng-template #otherAction>
              <button
                *ngIf="user.action"
                (click)="handleAction(user)"
                class="text-indigo-600 hover:text-indigo-900 focus:outline-none focus:underline"
                [ngClass]="getActionClass(user.action)"
              >
                {{ getActionLabel(user.action) }}
              </button>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- Empty state when no users are found -->
  <div *ngIf="users.length === 0" class="text-center p-8 text-gray-500">
    No businesses found.
  </div>
</div>

  <!-- Pagination Section -->
  <div class="flex mt-5 justify-center mb-5">
    <nav aria-label="Pagination" class="flex flex-col text-xs max-w-[500px] text-neutral-500">
      <div class="flex gap-8 items-start w-full">
        <label for="itemsPerPage" class="grow self-stretch">Items per page:</label>
        <div class="flex gap-2.5 whitespace-nowrap">
          <select
            id="itemsPerPage"
            [ngModel]="itemsPerPage"
            (change)="onItemsPerPageChange($event)"
            class="px-2 py-0.5 bg-neutral-100 rounded border border-gray-300"
            aria-label="Select items per page"
          >
            <option *ngFor="let num of itemsPerPageOptions" [value]="num">{{ num }}</option>
          </select>
        </div>
        <div class="flex gap-10 items-center mt-1">
          <p class="self-stretch">{{ itemsRange }}</p>
          <div class="flex gap-4">
            <button
              aria-label="Previous page"
              [disabled]="currentPage === 1"
              (click)="previousPage()"
              class="focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed p-1"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
            </button>
            <button
              aria-label="Next page"
              [disabled]="currentPage === totalPages"
              (click)="nextPage()"
              class="focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed p-1"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </nav>
  </div>
</div>

<!-- Add Business Modal -->
<app-add-business-user-modal
  *ngIf="showModal"
  [showModal]="showModal"
  (closeModal)="closeModal()"
  (addUser)="handleAddUser($event)"
></app-add-business-user-modal>